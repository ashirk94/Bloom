<div class="login-wrapper">
	<h1 class="title">Create Your Account</h1>
	<h2 class="subtitle">Complete your profile to find amazing friends!</h2>
	<% if (locals.successMessage) { %>
		<div class="success-msg">âœ… <%= locals.successMessage %></div>
	<% } %>
	<% if (locals.errorMessage) { %>
		<div class="error-msg">âŒ <%= locals.errorMessage %></div>
	<% } %>
	<div id="validation"></div>
	<div id="success"></div>
	
	<!-- Multi-step form -->
	<form id="reg-form" method="post" enctype="multipart/form-data" autocomplete="off">
		<!-- Step 1: Basic Info -->
		<div class="form-step active" id="step-1">
			<h3>Step 1: Basic Information</h3>
			<input type="text" placeholder="Email Address" name="uname" id="username" required />
			<input type="text" placeholder="Display Name (First Name)" name="displayName" id="displayName" required />
			<img src="/images/eye-slash-regular.png" class="eye" onclick="showPassword()" id="pass-checkbox"/>
			<input type="password" name="pw" placeholder="Password" id="password" required />
			<img src="/images/eye-slash-regular.png" class="eye" onclick="showConfirm()" id="confirm-checkbox"/>
			<input type="password" placeholder="Re-enter Password" id="confirm" required />
			<button type="button" class="btn btn-primary" onclick="nextStep(2)">Next: Bio & Location</button>
		</div>

		<!-- Step 2: Bio and Location -->
		<div class="form-step" id="step-2">
			<h3>Step 2: Tell us about yourself</h3>
			<textarea name="bio" placeholder="Write a short bio about yourself..." rows="3" class="form-textarea"></textarea>
			
			<!-- Profile Picture Upload -->
			<div class="profile-pic-section">
				<h4>Add a Profile Picture (Optional)</h4>
				<input type="file" name="image" id="profile-pic-input" accept="image/*" class="file-input">
				<div id="profile-pic-preview"></div>
			</div>
			
			<div class="location-section">
				<p>ğŸ“ We need your location to help you find friends nearby</p>
				<button type="button" class="btn btn-secondary" id="get-location-btn">Get My Location</button>
				<div id="location-status"></div>
			</div>
			<input type="hidden" name="lat" id="lat" />
			<input type="hidden" name="lon" id="lon" />
			<div class="step-buttons">
				<button type="button" class="btn btn-secondary" onclick="prevStep(1)">Previous</button>
				<button type="button" class="btn btn-primary" onclick="nextStep(3)">Next: Interests</button>
			</div>
		</div>

		<!-- Step 3: Interests -->
		<div class="form-step" id="step-3">
			<h3>Step 3: Select Your Interests</h3>
			<p>Choose up to 5 interests that describe you:</p>
			<div class="interests-grid">
				<label class="interest-item"><input type="checkbox" name="interests" value="Photography"> ğŸ“¸ Photography</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Hiking"> ğŸ¥¾ Hiking</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Travel"> âœˆï¸ Travel</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Art"> ğŸ¨ Art</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Reading"> ğŸ“š Reading</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Technology"> ğŸ’» Technology</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Gaming"> ğŸ® Gaming</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Coffee"> â˜• Coffee</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Music"> ğŸµ Music</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Movies"> ğŸ¬ Movies</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Yoga"> ğŸ§˜ Yoga</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Gardening"> ğŸŒ± Gardening</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Cooking"> ğŸ‘¨â€ğŸ³ Cooking</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Meditation"> ğŸ•¯ï¸ Meditation</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Nature"> ğŸŒ² Nature</label>
				<label class="interest-item"><input type="checkbox" name="interests" value="Writing"> âœï¸ Writing</label>
			</div>
			<div class="step-buttons">
				<button type="button" class="btn btn-secondary" onclick="prevStep(2)">Previous</button>
				<button type="button" class="btn btn-primary" onclick="nextStep(4)">Next: Values</button>
			</div>
		</div>

		<!-- Step 4: Values -->
		<div class="form-step" id="step-4">
			<h3>Step 4: Select Your Values</h3>
			<p>Choose up to 5 values that are important to you:</p>
			<div class="values-grid">
				<label class="value-item"><input type="checkbox" name="values" value="Adventure"> ğŸš€ Adventure</label>
				<label class="value-item"><input type="checkbox" name="values" value="Creativity"> ğŸ¨ Creativity</label>
				<label class="value-item"><input type="checkbox" name="values" value="Honesty"> ğŸ’¯ Honesty</label>
				<label class="value-item"><input type="checkbox" name="values" value="Growth"> ğŸ“ˆ Growth</label>
				<label class="value-item"><input type="checkbox" name="values" value="Independence"> ğŸ¦… Independence</label>
				<label class="value-item"><input type="checkbox" name="values" value="Innovation"> ğŸ’¡ Innovation</label>
				<label class="value-item"><input type="checkbox" name="values" value="Learning"> ğŸ“– Learning</label>
				<label class="value-item"><input type="checkbox" name="values" value="Friendship"> ğŸ¤ Friendship</label>
				<label class="value-item"><input type="checkbox" name="values" value="Humor"> ğŸ˜„ Humor</label>
				<label class="value-item"><input type="checkbox" name="values" value="Reliability"> âš¡ Reliability</label>
				<label class="value-item"><input type="checkbox" name="values" value="Peace"> â˜®ï¸ Peace</label>
				<label class="value-item"><input type="checkbox" name="values" value="Health"> ğŸ’ª Health</label>
				<label class="value-item"><input type="checkbox" name="values" value="Mindfulness"> ğŸ§  Mindfulness</label>
				<label class="value-item"><input type="checkbox" name="values" value="Compassion"> â¤ï¸ Compassion</label>
				<label class="value-item"><input type="checkbox" name="values" value="Balance"> âš–ï¸ Balance</label>
				<label class="value-item"><input type="checkbox" name="values" value="Knowledge"> ğŸ“ Knowledge</label>
			</div>
			<div class="step-buttons">
				<button type="button" class="btn btn-secondary" onclick="prevStep(3)">Previous</button>
				<input type="submit" value="Create Account" class="btn btn-primary" />
			</div>
		</div>
	</form>
    
    <div class="center-button button-container">
		<a href="/auth/github" class="github-login-button">
			<img src="/images/github-logo.png" alt="GitHub Logo" class="github-logo" />
			Sign up with GitHub
		</a>
	</div>
</div>

<style>
.form-step {
    display: none;
}
.form-step.active {
    display: block;
}
.form-textarea {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-family: inherit;
    resize: vertical;
}
.location-section {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    text-align: center;
}
.interests-grid, .values-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
    margin: 15px 0;
}
.interest-item, .value-item {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    border: 2px solid #e9ecef;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}
.interest-item:hover, .value-item:hover {
    border-color: #007bff;
    background-color: #f8f9fa;
}
.interest-item input:checked + *, .value-item input:checked + * {
    border-color: #007bff;
    background-color: #e7f3ff;
}
.interest-item input, .value-item input {
    margin-right: 8px;
}
.step-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
}
#location-status {
    margin-top: 10px;
    font-weight: bold;
}

.profile-pic-section {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    text-align: center;
}

.profile-pic-section h4 {
    margin: 0 0 10px 0;
    color: #495057;
}

.file-input {
    margin: 10px 0;
    padding: 8px;
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    width: 100%;
    cursor: pointer;
}

.file-input:hover {
    border-color: #007bff;
}

#profile-pic-preview {
    margin-top: 10px;
}

#profile-pic-preview img {
    max-width: 150px;
    max-height: 150px;
    border-radius: 50%;
    border: 3px solid #007bff;
}
</style>

<script src="/location.js" defer></script>
<script src="/register.js" defer></script>
<script>
function nextStep(step) {
    // Validate current step
    const currentStep = document.querySelector('.form-step.active');
    const inputs = currentStep.querySelectorAll('input[required]');
    let valid = true;
    
    inputs.forEach(input => {
        if (!input.value.trim()) {
            valid = false;
            // Remove red border validation - just show alert
        }
    });
    
    // Special validation for interests and values (max 5)
    if (step === 4) {
        const checkedInterests = document.querySelectorAll('input[name="interests"]:checked');
        if (checkedInterests.length === 0) {
            alert('Please select at least one interest');
            return;
        }
        if (checkedInterests.length > 5) {
            alert('Please select no more than 5 interests');
            return;
        }
    }
    
    if (step === 5) {
        const checkedValues = document.querySelectorAll('input[name="values"]:checked');
        if (checkedValues.length === 0) {
            alert('Please select at least one value');
            return;
        }
        if (checkedValues.length > 5) {
            alert('Please select no more than 5 values');
            return;
        }
    }
    
    if (!valid) {
        alert('Please fill in all required fields');
        return;
    }
    
    // Hide current step and show next
    currentStep.classList.remove('active');
    document.getElementById('step-' + step).classList.add('active');
}

function prevStep(step) {
    const currentStep = document.querySelector('.form-step.active');
    currentStep.classList.remove('active');
    document.getElementById('step-' + step).classList.add('active');
}

// Limit interest and value selections
document.addEventListener('change', function(e) {
    if (e.target.name === 'interests') {
        const checked = document.querySelectorAll('input[name="interests"]:checked');
        if (checked.length > 5) {
            e.target.checked = false;
            alert('You can select maximum 5 interests');
        }
    }
    if (e.target.name === 'values') {
        const checked = document.querySelectorAll('input[name="values"]:checked');
        if (checked.length > 5) {
            e.target.checked = false;
            alert('You can select maximum 5 values');
        }
    }
});

// Profile picture preview
document.getElementById('profile-pic-input').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('profile-pic-preview');
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.innerHTML = '<img src="' + e.target.result + '" alt="Profile Preview">';
        };
        reader.readAsDataURL(file);
    } else {
        preview.innerHTML = '';
    }
});

// Location functionality
document.getElementById('get-location-btn').addEventListener('click', function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            document.getElementById('lat').value = position.coords.latitude;
            document.getElementById('lon').value = position.coords.longitude;
            document.getElementById('location-status').innerHTML = 'âœ… Location captured successfully!';
            document.getElementById('location-status').style.color = 'green';
        }, function() {
            document.getElementById('location-status').innerHTML = 'âŒ Unable to get location';
            document.getElementById('location-status').style.color = 'red';
        });
    } else {
        document.getElementById('location-status').innerHTML = 'âŒ Geolocation not supported';
        document.getElementById('location-status').style.color = 'red';
    }
});
</script>
